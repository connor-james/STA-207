---
title: "Capturing effects of class sizes with classroom performacne"
author: "Connor Rosenberg"
date: "1/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#Required Packages

library("AER")
library("ggplot2")
library("car")
library("dplyr")
library("plotly")
library("sqldf")

```

```{r, include=FALSE}
#Prepare Data

data("STAR")

star = data.frame( "gender" = STAR$gender, "ethnicity" = STAR$ethnicity, "star1" = STAR$star1, "math1" = STAR$math1)


star = star[complete.cases(star),] #Eliminate all cases w/ NA
```

```{r, include=FALSE}
#Check data & objects

#str(star)

star$gender = as.factor(star$gender)
star$ethnicity = as.factor(star$ethnicity)
star$star1 = as.factor(star$star1)

```


```{r, include=FALSE}
#Task 1 Summary Statistics:
#NOTE: Please save all figures as objects to be called later in the report
#NOTE: Use plotly package to make everything consistant https://plot.ly/r

summary(star)

#Boxplot of Gender
count = data.frame(table(star$gender))
pieGender = plot_ly(count, labels = ~Var1, values = ~Freq, type = 'pie') %>%
  layout(title = "Gender of Participating Studnets")
pieGender
```


```{r, include=FALSE}

a = sqldf("SELECT math1 FROM star WHERE star1 == 'small'")
b = sqldf("SELECT math1 FROM star WHERE star1 == 'regular+aide'")
c = sqldf("SELECT math1 FROM star WHERE star1 == 'regular'")

hist2 <- plot_ly(alpha = 0.1) %>%
  add_histogram(x = ~a$math1) %>%
  add_histogram(x = ~b$math1) %>%
  add_histogram(x = ~c$math1) %>%
  layout(barmode = "overlay")

hist2

```


```{r, include = FALSE}
#Fitting the model

# Test for variance homogeneity
leveneTest(math1~star1, data = star) #Equal Variacnes


#One-Way ANOVA for STAR1
reg1 = lm(math1~star1, data = star)
summary(reg1)
anova1 = anova(reg1)
anova1

plot(reg1,2)
plot(reg1)


#Plot of boxplot of math scores broken by class type
box1 = plot_ly(star, y = ~math1, color = ~star1, type = "box")
box1
```

```{r, include = FALSE}
#Write the reprt below
```


# Introduction

## Background

## Questions of Interest

# Methods & Analysis

## Descriptive Analysis

## One-Way ANOVA Model
For our analysis, we selected the cell means ANOVA model to capture the effects of each of  differet class treatment. This model is most useful in our analysis becasure it represents the expected change in math test-score of a studnet from the standard regular class. The final model selected in this analysis is described below.

$$MathScore = \mu +T_2X_2 + T_3X_3 $$
where:

$X_2 = 1$ if the stduent is assigned to a small class and $0$ otherwise.
$X_3 = 1$ if the stduent is assigned to a regular + aid class and $0$ otherwise.

In this model, $\mu$ represnets the average first-grade math test-score for studnets enrolled in regular classes. Furthermore, $T_2$ represents the average change in score for studnets enrolled in small classes and $T_3$ represnets the average change in score for studnets enrolled in regualr+aid clases, both compared to the regular class treatment. 

Before fitting the model described above, it is imporatnt to examine the model assumptions.

1) Normailty

Examining the histogram of math scores across each of the three different classroom treatments, we can see that the scores of each treatment appear to follow a normal-like distribution. We can also note that each treatment distribution has slightly heavy left-tails; however, they do not deviate too much from our model assumptions and therefore, we may continue without transformating our data to fit this assumption.  
```{r, fig.width=8, fig.height=6, echo = FALSE}
hist2
```

2) Independence

It is not reasonable to assume a strict independce of our samples through this study. Studnets may study together, teachers may share materials, or parents may seek out tutoring for thier child. However, this study represnets the most controlled and rhobust method we could possible obtain to examine the effects of class size of math test scores of first graders. Paired with the large sample size, while these smaples are not strictly independnet we can consider them practically indepenent since the study represents the most controlled enviorment we could possible obtain.

3) Equality of Variance


```{r, echo=FALSE}
leveneTest(math1~star1, data = star) #Equal Variacnes
```


### Model Results



After constructing the cell means model described above, we found significnat evidence that the  

```{r, echo=FALSE}
anova1
```


### Sensitivity Analysis

#Results & Conclusions



