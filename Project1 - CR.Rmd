---
title: "Capturing effects of class sizes with classroom performacne"
author: "Connor Rosenberg"
date: "1/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#Required Packages

library("AER")
library("sqldf")
library("ggplot2")
library("car")
library("dplyr")
library("plotly")

```

```{r, include=FALSE}
#Prepare Data

data("STAR")

star = sqldf("SELECT  gender, ethnicity, birth, star1, math1, lunch1,school1, degree1, ladder1, experience1, tethnicity1,system1, schoolid1 FROM STAR")

star = star[complete.cases(star),] #Eliminate all cases w/ NA
```

```{r, include=FALSE}
#Check data & objects

#str(star)

star$gender = as.factor(star$gender)
star$ethnicity = as.factor(star$ethnicity)
star$star1 = as.factor(star$star1)
star$lunch1 = as.factor(star$lunch1)
star$degree1 = as.factor(star$degree1)
star$ladder1 = as.factor(star$ladder1)
star$tethnicity1 = as.factor(star$tethnicity1)
star$system1 = as.factor(star$system1)
star$schoolid1 = as.factor(star$schoolid1)

```


```{r, include= FALSE}
#Set colors for pretty pictures

color2 = c("#FF6868", "#54B7FF")
color3 = c("#FF6868", "#54B7FF", "97FF68")
color4 = c("#FF6868", "#54B7FF", "97FF68", "#A168FF")
color5 = c("#FF6868", "#54B7FF", "97FF68", "#A168FF", "#FFB768")
color5 = c("#FF6868", "#54B7FF", "97FF68", "#A168FF", "#FFB768", "#FFE068")
 

#NOTE: colors will be assigned to factors in alphabetical order
```


```{r, include=FALSE}
#Task 1 Summary Statistics:
#NOTE: Please save all figures as objects to be called later in the report
#NOTE: Use plotly package to make everything consistant https://plot.ly/r

summary(star)

#Boxplot of Gender
count = data.frame(table(star$gender))
pieGender = plot_ly(count, labels = ~Var1, values = ~Freq, type = 'pie') %>%
  layout(title = "Gender of Participating Studnets")
```


```{r}

## Test for variance homogeneity
leveneTest(math1~star1, data = star) #Equal Variacnes


#One-Way ANOVA for STAR1
reg1 = lm(math1~star1, data = star)
summary(reg1)
anova1 = anova(reg1)
anova1
boxplot(star1$math1~star1$star1)

plot(reg1,2)





means = aggregate(math1 ~ star1, star, mean)
ggplot(data = star,
       aes(x=star1,y=math1,fill=star1))+
  geom_boxplot()+
  stat_summary(fun.y = mean, colour = "black", geom = "point",shape = 18, size = 2, show_guide = FALSE) +
  geom_text(data = means, aes(label = round(math1,2), y=math1+10))


```

